@page "/chatbot"
@using Application.Abstractions.Contracts.Gateways
@using Application.Abstractions.Contracts.Gateways.Dtos
@inject IAIChatGateway AIChatGateway

<h3>AI Chatbot</h3>

<div>
    <label>Vælg rolle:</label>
    <select @bind="SelectedRole">
        <option value="owner">Owner</option>
        <option value="patient">Patient</option>
        <option value="guest">Guest</option>
    </select>
</div>

<div>
    <input @bind ="UserMessage" placeholder="Skriv besked..." />
    <button @onclick ="SendMessage">Send</button>
</div>

<div>
    <h4>AI svar:</h4>
    <p>@BotResponse</p>
</div>

@code {
    private string SelectedRole { get; set; } = "guest";
    private string UserMessage { get; set; } = "";
    private string BotResponse { get; set; } = "";

    private async Task SendMessage()
    {
        if (string.IsNullOrWhiteSpace(UserMessage))
            return;

        var request = new ChatRequestDto
        {
            Role = SelectedRole,
            Message = UserMessage
        };

        try
        {
            var response = await AIChatGateway.SendMessageAsync(request);
            BotResponse = response.Response;
        }
        catch (Exception ex)
        {
            BotResponse = $"Fejl: {ex.Message}";
        }

        UserMessage = "";
    }
}
